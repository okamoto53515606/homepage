/**
 * CLI: サイト設定初期化コマンド
 *
 * Firestoreの 'settings' コレクションに、サイト全体の設定を
 * 格納する 'site_config' ドキュメントを作成・初期化します。
 *
 * 【使い方】
 * npm run init-settings
 *
 * 【セキュリティ】
 * 本番環境 (NODE_ENV=production) では実行できません。
 */
import 'dotenv/config';
import { getAdminDb } from '../src/lib/firebase-admin';
import { FieldValue } from 'firebase-admin/firestore';

// 本番環境での実行を防止
if (process.env.NODE_ENV === 'production') {
  console.error('エラー: このスクリプトは本番環境では実行できません。');
  process.exit(1);
}

// --- 以下に設定値を定義 ---

const siteConfig = {
  siteName: 'homepage',
  paymentAmount: 500,
  accessDurationDays: 30,
  metaTitle: 'homepage - 思慮深いコンテンツのための場所',
  metaDescription: '広告モデルに疲れた人のためのミニマムなメディア',

  // A6. 特定商取引法に基づく表記
  legalCommerceContent: `
特定商取引法に基づく表記

販売業者
【要書き換え】屋号または会社名

運営統括責任者
【要書き換え】氏名

所在地
【要書き換え】住所（個人の場合、請求があれば遅滞なく開示）

電話番号
【要書き換え】電話番号（個人の場合、請求があれば遅滞なく開示）

メールアドレス
【要書き換え】お問い合わせ用メールアドレス

販売価格
500円（税込）

追加手数料
なし

支払方法
クレジットカード（VISA、Mastercard、American Express、JCB）
※決済はStripe社のシステムを利用

支払時期
商品注文時に即時決済

商品の引渡時期
決済完了後、即時（有料記事へのアクセス権が付与されます）

商品の内容
当サイトの有料記事閲覧権（30日間）

返品・キャンセルについて
デジタルコンテンツという商品の性質上、購入後の返品・返金には原則として応じかねます。
ただし、以下の場合は個別に対応いたします。
・技術的な問題により記事が閲覧できない場合
・明らかな二重課金が発生した場合
上記に該当する場合は、メールにてお問い合わせください。

動作環境
以下のブラウザの最新版を推奨します。
・Google Chrome
・Microsoft Edge
・Mozilla Firefox
・Apple Safari
`.trim(),

  // A7. プライバシーポリシー
  privacyPolicyContent: `
プライバシーポリシー

【要書き換え】屋号または会社名（以下「当サイト」）は、当サイトが提供するサービス（以下「本サービス」）における、ユーザーの個人情報の取り扱いについて、以下のとおりプライバシーポリシーを定めます。

1. 収集する情報

当サイトは、本サービスの提供にあたり、以下の情報を収集します。

(1) Googleアカウント情報
・メールアドレス
・表示名
・プロフィール画像URL

(2) 決済情報
・決済日時
・決済金額
・Stripeが発行する決済ID
※クレジットカード番号等の機密情報は、決済代行会社（Stripe社）が管理しており、当サイトでは保持しません。

(3) アクセス情報
・アクセス日時
・IPアドレス（不正利用防止の目的で一時的に記録）

2. 情報の利用目的

収集した情報は、以下の目的で利用します。

・本サービスの提供および運営
・有料コンテンツへのアクセス権管理
・ユーザーからのお問い合わせへの対応
・利用規約に違反する行為への対応
・サービスの改善および新機能の開発

3. 第三者提供

当サイトは、以下の場合を除き、ユーザーの個人情報を第三者に提供しません。

・ユーザーの同意がある場合
・法令に基づく場合
・人の生命、身体または財産の保護のために必要がある場合

4. 外部サービスの利用

当サイトでは、以下の外部サービスを利用しています。

(1) Firebase（Google LLC）
認証およびデータ管理に使用しています。
Googleのプライバシーポリシー: https://policies.google.com/privacy

(2) Stripe（Stripe, Inc.）
決済処理に使用しています。
Stripeのプライバシーポリシー: https://stripe.com/jp/privacy

5. セキュリティ

当サイトは、個人情報の漏洩、滅失、毀損を防止するため、適切なセキュリティ対策を講じています。

・通信の暗号化（HTTPS）
・認証情報の安全な管理（HttpOnlyセッションクッキー）
・アクセス制御の実施

6. お問い合わせ

個人情報の取り扱いに関するお問い合わせは、以下までご連絡ください。

メールアドレス: 【要書き換え】お問い合わせ用メールアドレス

7. 改定

当サイトは、必要に応じて本ポリシーを改定することがあります。
重要な変更がある場合は、サイト上でお知らせします。

制定日: 【要書き換え】YYYY年MM月DD日
`.trim(),

  // A8. 利用規約
  termsOfServiceContent: `
利用規約

この利用規約（以下「本規約」）は、【要書き換え】屋号または会社名（以下「当サイト」）が提供するサービス（以下「本サービス」）の利用条件を定めるものです。ユーザーの皆様には、本規約に同意いただいた上で、本サービスをご利用いただきます。

第1条（適用）

本規約は、ユーザーと当サイトとの間の本サービスの利用に関わる一切の関係に適用されます。

第2条（利用登録）

1. 本サービスの利用を希望する方は、Googleアカウントによる認証をもって利用登録を行うものとします。
2. 当サイトは、以下の場合に利用登録を拒否することがあります。
   ・虚偽の情報を登録した場合
   ・過去に本規約に違反したことがある場合
   ・その他、当サイトが不適切と判断した場合

第3条（有料サービス）

1. 有料記事の閲覧には、所定の料金（500円・税込）をお支払いいただく必要があります。
2. 決済完了後、30日間すべての有料記事を閲覧できます。
3. 購入後のキャンセル・返金は、特定商取引法に基づく表記に記載の場合を除き、お受けできません。

第4条（禁止事項）

ユーザーは、本サービスの利用にあたり、以下の行為をしてはなりません。

・法令または公序良俗に違反する行為
・犯罪行為に関連する行為
・当サイトのサーバーまたはネットワークの機能を破壊、妨害する行為
・本サービスのコンテンツを無断で複製、転載、再配布する行為
・他のユーザーのアカウントを不正に使用する行為
・他のユーザーに対する誹謗中傷、嫌がらせ行為
・当サイトのサービス運営を妨害する行為
・不正アクセスを試みる行為
・その他、当サイトが不適切と判断する行為

第5条（本サービスの提供の停止）

当サイトは、以下の場合に、ユーザーへの事前通知なく本サービスの全部または一部の提供を停止することがあります。

・システムの保守点検を行う場合
・火災、停電、天災等により提供が困難になった場合
・その他、当サイトが必要と判断した場合

第6条（利用制限および登録抹消）

当サイトは、ユーザーが本規約に違反した場合、事前の通知なく利用制限または登録抹消を行うことがあります。この場合、支払済みの料金の返金は行いません。

第7条（免責事項）

1. 当サイトは、本サービスに関して、その完全性、正確性、確実性、有用性等について保証しません。
2. 当サイトは、ユーザーが本サービスを利用することによって生じた損害について、一切の責任を負いません。ただし、当サイトの故意または重過失による場合はこの限りではありません。

第8条（サービス内容の変更）

当サイトは、ユーザーへの事前通知なく、本サービスの内容を変更することがあります。

第9条（利用規約の変更）

当サイトは、必要と判断した場合には、ユーザーへの事前通知なく本規約を変更することがあります。変更後の利用規約は、サイト上に掲載した時点から効力を生じるものとします。

第10条（準拠法・管轄裁判所）

1. 本規約の解釈にあたっては、日本法を準拠法とします。
2. 本サービスに関して紛争が生じた場合には、【要書き換え】地名 地方裁判所を第一審の専属的合意管轄とします。

制定日: 【要書き換え】YYYY年MM月DD日
`.trim(),
};

/**
 * 設定をFirestoreに書き込むメイン関数
 */
const initializeSettings = async () => {
  try {
    console.log('Firestoreに接続中...');
    const db = getAdminDb();

    const settingsRef = db.collection('settings').doc('site_config');

    console.log('サイト設定を書き込んでいます...');
    await settingsRef.set({
      ...siteConfig,
      updatedAt: FieldValue.serverTimestamp(),
    });

    console.log('✅ 成功しました！');
    console.log("Firestoreの 'settings' コレクションに 'site_config' ドキュメントを作成/更新しました。");

  } catch (error: any) {
    console.error('エラーが発生しました:', error.message);
    process.exit(1);
  }
};

initializeSettings();
